<!doctype html><html lang="pt-BR"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Cadastro — SocialPrimeBR</title>
<link rel="icon" href="img/favicon.svg"/>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="assets/theme.css"/>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="assets/config.js"></script>
</head><body>
<canvas id="bg"></canvas>

<div class="container">
<div class="card">
  <h2>Criar conta</h2>
  <div class="grid cards-2">
    <div><label>Nome</label><input class="input" id="first" placeholder="Seu nome"/></div>
    <div><label>Sobrenome</label><input class="input" id="last" placeholder="Seu sobrenome"/></div>
  </div>
  <div class="grid cards-2">
    <div><label>E‑mail</label><input class="input" id="email" type="email"/></div>
    <div><label>CPF/CNPJ</label><input class="input" id="doc" placeholder="Somente números"/></div>
  </div>
  <label>Senha</label><input class="input" id="password" type="password" placeholder="Mín. 8, com letra maiúscula"/>
  <div class="actions" style="margin-top:10px"><button class="btn" id="btnSign">Criar conta</button><a class="btn" href="login.html">Já tenho conta</a></div>
  <div class="mono" id="msg"></div>
</div>
<script>
const supabase = window.supabase.createClient(window.SP_URL, window.SP_ANON);
function validPwd(p){return /[A-Z]/.test(p)&&/[0-9]/.test(p)&&p.length>=8}
function onlyDigits(s){return s.replace(/\D/g,'')}
document.getElementById('btnSign').addEventListener('click', async ()=>{
  const first=cap(document.getElementById('first').value.trim());
  const last=cap(document.getElementById('last').value.trim());
  const email=document.getElementById('email').value.trim();
  const doc=onlyDigits(document.getElementById('doc').value);
  const password=document.getElementById('password').value;
  if(!first||!last||!email||!doc||!password){ return msg('Preencha todos os campos.'); }
  if(!validPwd(password)) return msg('Senha fraca: mínimo 8, com número e maiúscula.');
  // sign up
  const { data, error } = await supabase.auth.signUp({ email, password, options:{ data:{ first_name:first, last_name:last, doc } } });
  if(error){ return msg('Erro: '+error.message); }
  msg('Conta criada. Se necessário confirme pelo link enviado ao e‑mail.');
  // tenta criar perfil (RLS deve permitir insert do próprio usuário)
  const { error: perr } = await supabase.from('profiles').upsert({ user_id: data.user?.id, first_name:first, last_name:last, email, doc });
  // ignora erro silenciosamente
  setTimeout(()=>location.href='login.html',1800);
});
function cap(s){return s? s[0].toUpperCase()+s.slice(1).toLowerCase():s}
function msg(t){document.getElementById('msg').textContent=t}
</script>
</div>
<footer>© 2025 SocialPrimeBR — Todos os direitos reservados.</footer>
<script src="assets/background.js"></script>
<script></script>
</body></html>
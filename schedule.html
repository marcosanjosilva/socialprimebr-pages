<!doctype html><html lang="pt-BR"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Agendar — SocialPrimeBR</title>
<link rel="icon" href="img/favicon.svg"/>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="assets/theme.css"/>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="assets/config.js"></script>
</head><body>
<canvas id="bg"></canvas>

<header>
  <div class="nav">
    <div class="brand" onclick="location.href='dashboard.html'"><svg class="bolt" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M10 2L3 13h6l-2 9 9-13h-6l2-7z" fill="url(#g)"/>
<defs><linearGradient id="g" x1="0" y1="0" x2="24" y2="24">
<stop stop-color="#7a5cff"/><stop offset="1" stop-color="#6ce1ff"/></linearGradient></defs></svg><span>SocialPrimeBR</span></div>
    <div class="spacer"></div>
    <nav class="actions">
      <a class="btn" href="calendar.html">Calendário</a>
      <a class="btn" href="schedule.html">Agendar</a>
      <a class="btn" href="workspaces.html">Trocar Perfil</a>
      <a class="btn" href="settings.html">Configurações</a>
      <button class="btn" id="btnLogout">Sair</button>
    </nav>
  </div>
</header>
<div class="container">
<div class="card">
  <h2>Nova publicação</h2>
  <div class="mono">Selecione os canais de publicação:</div>
  <div id="channels" class="actions" style="margin-top:8px;flex-wrap:wrap"></div>
  <hr class="sep"/>
  <div class="grid cards-2">
    <div><label>Arquivo</label><input class="input" id="file" type="file"/></div>
    <div><label>Legenda</label><textarea class="input" id="caption" rows="4" placeholder="Texto (habilitado conforme canais)"></textarea><div class="mono" id="count"></div></div>
  </div>
  <hr class="sep"/>
  <div class="grid cards-2">
    <div><label>Primeira data</label><input class="input" id="date1" type="date"/></div>
    <div><label>Adicionar mais datas</label><button class="btn" id="addDate" style="margin-top:4px">Adicionar</button><div id="more"></div></div>
  </div>
  <div class="actions" style="margin-top:12px"><button class="btn" id="btnSave">Agendar</button><a class="btn" href="calendar.html">Ver calendário</a></div>
  <div class="mono" id="msg"></div>
</div>
<script>
const CH = [
 {k:'ig_feed',  n:'IG Feed',   acceptsText:true,  max:2200, media:'photo'},
 {k:'ig_reels', n:'IG Reels',  acceptsText:true,  max:2200, media:'video'},
 {k:'ig_story', n:'IG Story',  acceptsText:true,  max:2200, media:'both'},
 {k:'fb_post',  n:'Facebook',  acceptsText:true,  max:63206, media:'both'},
 {k:'ttk',      n:'TikTok',    acceptsText:true,  max:2200, media:'video'},
 {k:'pin',      n:'Pinterest', acceptsText:true,  max:500,  media:'photo'},
 {k:'yt',       n:'YouTube',   acceptsText:false, max:0,    media:'video'},
 {k:'yt_s',     n:'YT Shorts', acceptsText:true,  max:100,  media:'video'},
 {k:'x',        n:'X',         acceptsText:true,  max:280,  media:'both'},
 {k:'gmb',      n:'Google',    acceptsText:true,  max:1500, media:'both'},
];
const chips=document.getElementById('channels');
const caption=document.getElementById('caption');const counter=document.getElementById('count');const file=document.getElementById('file');
let selected=new Set();
CH.forEach(c=>{ const b=document.createElement('button'); b.className='btn'; b.type='button'; b.textContent=c.n; b.onclick=()=>{ if(selected.has(c.k)) selected.delete(c.k); else selected.add(c.k); b.style.outline= selected.has(c.k)? '2px solid var(--accent2)' : 'none'; applyRules();}; chips.appendChild(b) });
function applyRules(){
  // texto permitido & limite
  const channels=[...selected].map(k=>CH.find(c=>c.k===k));
  const acceptsText = channels.every(c=>c.acceptsText!==false);
  caption.disabled=!acceptsText;
  const max = channels.length? Math.min(...channels.filter(c=>c.acceptsText!==false).map(c=>c.max)):0;
  counter.textContent = acceptsText? `Limite: ${max} caracteres` : 'Legenda não permitida para canais selecionados.';
  // mídia compatível
  const types=new Set(channels.map(c=>c.media));
  let want='both'; if(types.has('video')&&!types.has('photo')) want='video'; if(types.has('photo')&&!types.has('video')) want='photo';
  file.accept = want==='video'? 'video/*' : (want==='photo'? 'image/*' : 'image/*,video/*');
}
applyRules();
document.getElementById('addDate').onclick=()=>{
  const i=document.createElement('input'); i.className='input'; i.type='date'; i.style.marginTop='6px'; document.getElementById('more').appendChild(i);
};
document.getElementById('btnSave').onclick=()=>{ document.getElementById('msg').textContent='(Exemplo) Salvaria na tabela de agendamentos com as validações aplicadas.'; };
</script>
</div>
<footer>© 2025 SocialPrimeBR — Todos os direitos reservados.</footer>
<script src="assets/background.js"></script>
<script>
const supabase = window.supabase.createClient(window.SP_URL, window.SP_ANON);

// Protect pages that need auth
(async()=>{
  const needAuth = !/index\.html|termos|politica|login\.html|cadastro\.html|recuperar\.html/.test(location.pathname);
  const { data: { session } } = await supabase.auth.getSession();
  if(needAuth && !session){ location.href='login.html'; }
})();

// Sair
document.getElementById('btnLogout')?.addEventListener('click', async ()=>{
  try{
    await supabase.auth.signOut();
  }finally{
    localStorage.clear();
    location.href='login.html';
  }
});

</script>
</body></html>
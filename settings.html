<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <title>Configurações — SocialPrimeBR</title>
  
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="color-scheme" content="dark light">
  <link rel="icon" type="image/svg+xml" href="favicon.svg" />
  <style>
    :root{ --bg:#0b0f17; --bg-2:#0f1522; --fg:#e6ecff; --muted:#9bb0d6;
           --brand:#6ea8ff; --brand-2:#8e7bff; --border:rgba(255,255,255,.08); --grid:rgba(255,255,255,.06);
           --ok:#6ef7a6; --warn:#ffd36e; --off:#a0a8c0; }
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;
      background: radial-gradient(1200px 800px at 80% -10%, #14223c 0%, transparent 60%),
                  radial-gradient(1000px 700px at -10% 100%, #1e1240 0%, transparent 60%),
                  linear-gradient(180deg, var(--bg) 0%, var(--bg-2) 100%);
      color:var(--fg); overflow-x:hidden;}
    .grid{position:fixed; inset:0; pointer-events:none; opacity:.35;
      background-image:linear-gradient(var(--grid) 1px, transparent 1px),
                       linear-gradient(90deg, var(--grid) 1px, transparent 1px);
      background-size:46px 46px, 46px 46px; mask-image: radial-gradient(ellipse at 50% 30%, rgba(255,255,255,.9) 0%, rgba(255,255,255,.2) 60%, transparent 100%);
      animation:drift 30s linear infinite; z-index:0;}
    @keyframes drift{from{background-position:0 0,0 0} to{background-position:200px 200px,200px 200px}}
    #fx{position:fixed; inset:0; width:100vw; height:100vh; z-index:0; pointer-events:none;}
    .mouse-glow{position:fixed; inset:0; pointer-events:none; z-index:0;
      background: radial-gradient(240px 240px at var(--mx,50%) var(--my,50%), rgba(38,144,255,.25), transparent 70%),
                  radial-gradient(480px 480px at calc(var(--mx,50%) + 8%) calc(var(--my,50%) + 12%), rgba(142,123,255,.18), transparent 70%);}
    header{position:sticky; top:0; z-index:3; display:flex; align-items:center; justify-content:space-between; gap:16px;
      padding:14px 22px; background:linear-gradient(180deg, rgba(10,15,23,.8), rgba(10,15,23,.2)); border-bottom:1px solid var(--border); backdrop-filter: blur(6px);}
    .brand{display:inline-flex; align-items:center; gap:10px; font-weight:800; text-decoration:none; color:var(--fg);}
    .brand svg{width:18px; height:18px}
    .btn{appearance:none; border:1px solid var(--border);
      background:linear-gradient(180deg, rgba(110,168,255,.18), rgba(110,168,255,.06)); color:#eaf2ff; padding:10px 14px; border-radius:10px;
      font-weight:600; font-size:14px; cursor:pointer; text-decoration:none; display:inline-flex; gap:8px;}
    .btn.secondary{ background:linear-gradient(180deg, rgba(142,123,255,.18), rgba(142,123,255,.06)); }
    .btn.mini{ padding:6px 10px; font-size:12px; border-radius:8px; }
    .icon-btn{background:transparent; border:1px solid var(--border); width:36px; height:36px; border-radius:10px; display:inline-grid; place-items:center; cursor:pointer;}
    .icon-btn:hover{border-color:rgba(255,255,255,.16)}
    .wrap{position:relative; z-index:1; padding:26px; max-width:1100px; margin:0 auto;}
    .muted{color:var(--muted)}
    .topline{display:flex; align-items:center; gap:8px; justify-content:center; font-weight:700;}
    .pill{border:1px solid var(--border); border-radius:999px; padding:8px 12px; background:rgba(255,255,255,.05);}
    .pill.primary{border-color:rgba(110,168,255,.40);
      background:linear-gradient(180deg, rgba(110,168,255,.16), rgba(142,123,255,.10));
      box-shadow:0 0 0 1px rgba(110,168,255,.2) inset;}
    .grid-cards{display:grid; grid-template-columns:repeat(auto-fit,minmax(230px,1fr)); gap:18px; margin-top:24px}
    .card{border:1px solid var(--border); background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border-radius:16px; padding:20px; min-height:120px; box-shadow:0 8px 30px rgba(0,0,0,.35);}
    .card h3{margin:0 0 8px; font-size:18px}
    .big{display:grid; grid-template-columns: repeat(4,minmax(160px,1fr)); gap:16px}
    .net{position:relative; border:1px solid var(--border); border-radius:16px; padding:18px; min-height:98px;
      background: radial-gradient(800px 400px at 120% -40%, rgba(110,168,255,.12), transparent 60%),
                  radial-gradient(800px 400px at -10% 120%, rgba(142,123,255,.12), transparent 60%),
                  linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      transition: transform .15s ease, box-shadow .15s ease, border-color .15s ease; cursor:default; display:flex; flex-direction:column; justify-content:space-between; gap:8px;}
    .net:hover{ transform: translateY(-2px); box-shadow:0 8px 30px rgba(0,0,0,.35); border-color:rgba(255,255,255,.16); }
    .net[data-state="off"]{ opacity:.55; filter:saturate(.7); }
    .net[data-state="on"]{ box-shadow:0 0 0 1px rgba(110,168,255,.25), 0 0 22px rgba(110,168,255,.25) inset; }
    .net .row{display:flex; align-items:center; justify-content:space-between;}
    .net .name{font-weight:800; letter-spacing:.6px}
    .badge{font-size:12px; border-radius:999px; padding:6px 10px; border:1px solid var(--border);}
    .badge.on{ color:var(--ok); border-color:rgba(110,247,166,.35); background:rgba(110,247,166,.06);}
    .badge.off{ color:var(--off); background:rgba(255,255,255,.03);}
    .status-dot{width:8px; height:8px; border-radius:50%; margin-right:6px; display:inline-block}
    .status-dot.on{ background:var(--ok); box-shadow:0 0 8px var(--ok);}
    .status-dot.off{ background:var(--off);}
    /* Modal */
    .modal-bg{position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:5;
      background:radial-gradient(600px 400px at 50% 20%, rgba(20,35,70,.6), transparent 60%), rgba(0,0,0,.35); backdrop-filter: blur(4px);}
    .modal{background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02)); border:1px solid var(--border); border-radius:16px; padding:20px; width:min(520px, 92vw);}
    .modal .row{display:flex; gap:10px; align-items:center}
    .modal input{width:100%; padding:10px 12px; border-radius:10px; background:rgba(255,255,255,.04); border:1px solid var(--border); color:var(--fg)}
    /* Side ChatGPT (desktop only) */
    .sidegpt{position:fixed; top:64px; right:12px; width:clamp(420px, 35vw, 560px); height:calc(100vh - 76px);
      border:1px solid var(--border); border-radius:16px; z-index:2; overflow:hidden;
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02)); box-shadow:0 10px 30px rgba(0,0,0,.45); display:none;}
    .sidegpt header{position:sticky; top:0; padding:10px 12px; display:flex; align-items:center; justify-content:space-between;
      background:linear-gradient(180deg, rgba(10,15,23,.86), rgba(10,15,23,.6)); border-bottom:1px solid var(--border);}
    .sidegpt .title{font-weight:800}
    .sidegpt .frame{width:100%; height:100%; border:0; background:#0b0f17}
    .sidegpt .fallback{padding:14px; font-size:14px}
    body.has-side .wrap{ max-width: calc(1100px + 36vw); margin-right: calc(36vw + 32px); }
    @media (min-width: 1200px){ .sidegpt{ display:block; } }
    /* Switch */
    .switch{position:relative; width:54px; height:30px}
    .switch input{opacity:0; width:0; height:0}
    .slider{position:absolute; inset:0; background:rgba(255,255,255,.06); border:1px solid var(--border); border-radius:999px; cursor:pointer; transition:.2s}
    .slider:before{content:""; position:absolute; height:22px; width:22px; left:4px; top:3px; background:#aab6d3; border-radius:50%; transition:.2s}
    .switch input:checked + .slider{background:rgba(110,168,255,.22); border-color:rgba(110,168,255,.45)}
    .switch input:checked + .slider:before{transform:translateX(24px); background:#6ea8ff}
  </style>
  <script type="module">
    addEventListener('mousemove', (e)=>{ document.documentElement.style.setProperty('--mx', e.clientX+'px'); document.documentElement.style.setProperty('--my', e.clientY+'px'); });
    function toggleSideByPref(){ const on = localStorage.getItem('sp_sidegpt_on')!=='0'; if(innerWidth>=1200 && on) document.body.classList.add('has-side'); else document.body.classList.remove('has-side'); }
    addEventListener('resize', toggleSideByPref); addEventListener('DOMContentLoaded', toggleSideByPref);
  </script>

</head>
<body>
<canvas id="fx"></canvas><div class="mouse-glow"></div><div class="grid"></div>
<header>
  
    <a class="brand" href="dashboard.html" title="Voltar ao Dashboard">
      <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><defs><linearGradient id="g" x1="0" y1="0" x2="1" y2="1"><stop offset="0" stop-color="#6ea8ff"/><stop offset="1" stop-color="#8e7bff"/></linearGradient></defs><path d="M36 6L12 36h13l-5 22 32-38H36z" fill="url(#g)"/></svg>
      SocialPrimeBR
    </a>
    
  <a class="btn" href="dashboard.html">Voltar ao Dashboard</a>
</header>
<main class="wrap">
  <div class="grid-cards">
    <div class="card">
      <h3>Alterar e-mail</h3>
      <label for="emailNew">Novo e-mail</label>
      <input id="emailNew" type="email" placeholder="novo@exemplo.com">
      <label for="passEmail">Sua senha atual</label>
      <input id="passEmail" type="password" placeholder="Senha atual">
      <div class="row" style="margin-top:10px">
        <button class="btn" id="btnEmail">Atualizar e-mail</button>
        <span id="msgEmail" class="muted"></span>
      </div>
      <small class="muted">Será enviado um link de confirmação para o novo e-mail.</small>
    </div>
    <div class="card">
      <h3>Alterar senha</h3>
      <label for="passOld">Senha atual</label>
      <input id="passOld" type="password">
      <label for="passNew">Nova senha</label>
      <input id="passNew" type="password" placeholder="Mín. 8, com letra maiúscula e número">
      <div class="row" style="margin-top:10px">
        <button class="btn" id="btnPass">Atualizar senha</button>
        <span id="msgPass" class="muted"></span>
      </div>
    </div>
    <div class="card">
      <h3>Painel do ChatGPT</h3>
      <p class="muted">Mostra um painel lateral no Dashboard (somente Desktop). Se preferir, desative aqui.</p>
      <label class="switch">
        <input type="checkbox" id="gptToggle">
        <span class="slider"></span>
      </label>
      <span id="gptMsg" class="muted" style="margin-left:10px"></span>
    </div>
    <div class="card">
      <h3>Seus perfis</h3>
      <p class="muted" id="infoW">Carregando…</p>
      <div id="wsList" class="grid-cards"></div>
    </div>
  </div>
</main>
<script type="module">
  import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';
  const supabase = createClient("https://mmfqumjckeumidrbysnf.supabase.co", "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1tZnF1bWpja2V1bWlkcmJ5c25mIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYyODg2NzAsImV4cCI6MjA3MTg2NDY3MH0.jlbBLPsz4CqsHqTKTUD5o1xtE8kvAok7x4s3VGaYAAA");
  // Toggle ChatGPT
  const chk = document.getElementById('gptToggle'); 
  chk.checked = localStorage.getItem('sp_sidegpt_on')!=='0';
  chk.addEventListener('change', ()=>{ 
    localStorage.setItem('sp_sidegpt_on', chk.checked ? '1' : '0');
    document.getElementById('gptMsg').textContent = chk.checked ? 'Ativado. Atualize o Dashboard para ver o painel.' : 'Desativado.';
  });
  // Email
  document.getElementById('btnEmail').addEventListener('click', async ()=>{ 
    const newEmail=(document.getElementById('emailNew').value||'').trim().toLowerCase();
    const pass=document.getElementById('passEmail').value;
    const msg=document.getElementById('msgEmail');
    const { data: { session } } = await supabase.auth.getSession();
    if(!session){ location.href='login.html'; return; }
    const { error: e1 } = await supabase.auth.signInWithPassword({ email: session.user.email, password: pass });
    if(e1){ msg.textContent = 'Senha incorreta.'; return; }
    const { error } = await supabase.auth.updateUser({ email: newEmail });
    msg.textContent = error ? ('Erro: '+error.message) : 'Verifique o novo e-mail para confirmar.';
  });
  // Password
  document.getElementById('btnPass').addEventListener('click', async ()=>{ 
    const oldp=document.getElementById('passOld').value;
    const newp=document.getElementById('passNew').value;
    const msg=document.getElementById('msgPass');
    if(!/^(?=.*[A-Z])(?=.*[a-z])(?=.*\d).{8,}$/.test(newp)){ msg.textContent='Senha fraca.'; return; }
    const { data: { session } } = await supabase.auth.getSession();
    if(!session){ location.href='login.html'; return; }
    const { error: e1 } = await supabase.auth.signInWithPassword({ email: session.user.email, password: oldp });
    if(e1){ msg.textContent='Senha atual incorreta.'; return; }
    const { error } = await supabase.auth.updateUser({ password: newp });
    msg.textContent = error ? ('Erro: '+error.message) : 'Senha atualizada com sucesso.';
  });
  // Perfis
  function wsCard(ws){
    const el=document.createElement('div'); el.className='card';
    const row=document.createElement('div'); row.className='row'; row.style.justifyContent='space-between';
    const name=document.createElement('strong'); name.textContent=ws.name;
    const trash=document.createElement('button'); trash.className='icon-btn'; trash.title='Excluir perfil';
    trash.innerHTML='🗑️';
    const confirm=document.createElement('div'); confirm.className='row';
    confirm.style.display='none'; confirm.style.marginTop='10px';
    const passInp=document.createElement('input'); passInp.type='password'; passInp.placeholder='Sua senha';
    const delBtn=document.createElement('button'); delBtn.className='btn'; delBtn.textContent='Confirmar exclusão';
    const msg=document.createElement('span'); msg.className='muted';
    confirm.appendChild(passInp); confirm.appendChild(delBtn); confirm.appendChild(msg);
    trash.addEventListener('click', ()=>{ confirm.style.display = confirm.style.display==='none' ? 'flex' : 'none'; });
    delBtn.addEventListener('click', async ()=>{ 
      const pwd=passInp.value||'';
      const { data: { session } } = await supabase.auth.getSession();
      if(!session){ location.href='login.html'; return; }
      const { error: authErr } = await supabase.auth.signInWithPassword({ email: session.user.email, password: pwd });
      if(authErr){ msg.textContent='Senha incorreta.'; return; }
      const { error } = await supabase.from('workspaces').delete().eq('id', ws.id);
      if(error){ msg.textContent = (error.code==='42P01' ? 'Tabela de perfis não existe.' : error.message); return; }
      if(localStorage.getItem('sp_active_ws_id')===ws.id){ localStorage.removeItem('sp_active_ws_id'); localStorage.removeItem('sp_active_ws_name'); }
      await loadWs();
    });
    const right=document.createElement('div'); right.className='row'; right.appendChild(trash);
    row.appendChild(name); row.appendChild(right);
    const p=document.createElement('p'); p.className='muted'; p.style.margin='6px 0 0'; p.textContent='Criado em '+new Date(ws.created_at).toLocaleDateString('pt-BR');
    el.appendChild(row); el.appendChild(p); el.appendChild(confirm);
    return el;
  }
  async function loadWs(){
    const list=document.getElementById('wsList'); list.innerHTML='';
    const info=document.getElementById('infoW');
    const { data: { session } } = await supabase.auth.getSession();
    if(!session){ location.href='login.html'; return; }
    try {
      const { data, error } = await supabase.from('workspaces').select('id,name,created_at').order('created_at');
      if(error) throw error;
      info.textContent = 'Você tem '+data.length+'/10 perfis.';
      data.forEach(ws=> list.appendChild(wsCard(ws)));
    } catch(err) {
      info.textContent = (err && (err.code==='42P01' || (err.message||'').includes('schema cache'))) ?
        'A tabela de perfis ainda não existe. Rode o SQL “supabase_workspaces.sql” no Supabase e depois execute: SELECT pg_notify(\'pgrst\', \'reload schema\');' :
        ('Erro: '+(err.message||err));
    }
  }
  loadWs();
</script>

  <script>
    const c = document.getElementById('fx'); if(c){ const ctx = c.getContext('2d', {alpha:true});
      let dpr=1,w=0,h=0,parts=[]; const cfg={count:90,maxSpeed:.32,radius:2,linkDist:120};
      function resize(){ dpr=Math.max(1, Math.min(devicePixelRatio||1,2)); w=c.width=Math.floor(innerWidth*dpr); h=c.height=Math.floor(innerHeight*dpr); c.style.width='100vw'; c.style.height='100vh'; }
      function rand(a,b){return a+Math.random()*(b-a)}
      function init(){ parts=Array.from({length:cfg.count},()=>({x:rand(0,w),y:rand(0,h),vx:rand(-cfg.maxSpeed,cfg.maxSpeed),vy:rand(-cfg.maxSpeed,cfg.maxSpeed)})); }
      function step(){ ctx.clearRect(0,0,w,h);
        for(let i=0;i<parts.length;i++){ const p=parts[i]; p.x+=p.vx; p.y+=p.vy; if(p.x<0||p.x>w) p.vx*=-1; if(p.y<0||p.y>h) p.vy*=-1;
          for(let j=i+1;j<parts.length;j++){ const q=parts[j], dx=p.x-q.x, dy=p.y-q.y, dist=Math.hypot(dx,dy);
            if(dist<cfg.linkDist*dpr){ const a=1-dist/(cfg.linkDist*dpr); ctx.strokeStyle='rgba(110,168,255,'+(0.25*a)+')'; ctx.lineWidth=1*dpr; ctx.beginPath(); ctx.moveTo(p.x,p.y); ctx.lineTo(q.x,q.y); ctx.stroke(); }
          }
          ctx.fillStyle='rgba(142,123,255,.9)'; ctx.beginPath(); ctx.arc(p.x,p.y,cfg.radius*dpr,0,Math.PI*2); ctx.fill();
        }
        requestAnimationFrame(step);
      }
      addEventListener('resize', ()=>{ resize(); init(); });
      resize(); init(); step();
    }
  </script>

</body>
</html>

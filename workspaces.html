<!doctype html><html lang="pt-BR"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Perfis — SocialPrimeBR</title>
<link rel="icon" href="img/favicon.svg"/>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="assets/theme.css"/>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="assets/config.js"></script>
</head><body>
<canvas id="bg"></canvas>

<header>
  <div class="nav">
    <div class="brand" onclick="location.href='dashboard.html'"><svg class="bolt" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M10 2L3 13h6l-2 9 9-13h-6l2-7z" fill="url(#g)"/>
<defs><linearGradient id="g" x1="0" y1="0" x2="24" y2="24">
<stop stop-color="#7a5cff"/><stop offset="1" stop-color="#6ce1ff"/></linearGradient></defs></svg><span>SocialPrimeBR</span></div>
    <div class="spacer"></div>
    <nav class="actions">
      <a class="btn" href="calendar.html">Calendário</a>
      <a class="btn" href="schedule.html">Agendar</a>
      <a class="btn" href="workspaces.html">Trocar Perfil</a>
      <a class="btn" href="settings.html">Configurações</a>
      <button class="btn" id="btnLogout">Sair</button>
    </nav>
  </div>
</header>
<div class="container">
<div class="card"><h2>Perfis (workspaces)</h2>
  <div id="list" class="grid cards-2"></div>
  <hr class="sep"/>
  <div class="grid cards-2">
    <div><label>Novo perfil</label><input class="input" id="name" placeholder="Ex.: Agência — Cliente A"/></div>
    <div class="actions"><button class="btn" id="btnCreate" style="margin-top:28px">Criar</button></div>
  </div>
  <div class="mono" id="msg"></div>
</div>
<script>
const supabase = window.supabase.createClient(window.SP_URL, window.SP_ANON);
function ui(ws){
  const d=document.createElement('div'); d.className='tile';
  d.innerHTML=`<div><div class="title">${ws.name}</div><div class="muted">Criado em ${new Date(ws.created_at).toLocaleDateString('pt-BR')}</div></div>
               <div class="actions"><button class="btn use">Usar</button></div>`;
  d.querySelector('.use').onclick=()=>{ localStorage.setItem('sp_active_ws_id', ws.id);localStorage.setItem('sp_active_ws_name', ws.name); location.href='dashboard.html'; };
  return d;
}
async function load(){
  const { data: { session } } = await supabase.auth.getSession(); if(!session) return location.href='login.html';
  const { data, error } = await supabase.from('workspaces').select('id,name,created_at').order('created_at');
  if(error){ return msg('Erro ao listar: '+error.message); }
  const list=document.getElementById('list'); list.innerHTML=''; (data||[]).forEach(ws=>list.appendChild(ui(ws)));
}
document.getElementById('btnCreate').onclick= async ()=>{
  const name=document.getElementById('name').value.trim(); if(!name) return;
  const { error } = await supabase.from('workspaces').insert({ name });
  if(error) return msg('Erro: '+error.message);
  document.getElementById('name').value=''; load();
}
function msg(t){document.getElementById('msg').textContent=t}
load();
</script>
</div>
<footer>© 2025 SocialPrimeBR — Todos os direitos reservados.</footer>
<script src="assets/background.js"></script>
<script>
const supabase = window.supabase.createClient(window.SP_URL, window.SP_ANON);

// Protect pages that need auth
(async()=>{
  const needAuth = !/index\.html|termos|politica|login\.html|cadastro\.html|recuperar\.html/.test(location.pathname);
  const { data: { session } } = await supabase.auth.getSession();
  if(needAuth && !session){ location.href='login.html'; }
})();

// Sair
document.getElementById('btnLogout')?.addEventListener('click', async ()=>{
  try{
    await supabase.auth.signOut();
  }finally{
    localStorage.clear();
    location.href='login.html';
  }
});

</script>
</body></html>
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <title>Dashboard — SocialPrimeBR</title>
  
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="color-scheme" content="dark light">
  <link rel="icon" type="image/svg+xml" href="favicon.svg" />
  <style>
    :root{ --bg:#0b0f17; --bg-2:#0f1522; --fg:#e6ecff; --muted:#9bb0d6;
           --brand:#6ea8ff; --brand-2:#8e7bff; --border:rgba(255,255,255,.08); --grid:rgba(255,255,255,.06);
           --ok:#6ef7a6; --warn:#ffd36e; --off:#a0a8c0; }
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;
      background: radial-gradient(1200px 800px at 80% -10%, #14223c 0%, transparent 60%),
                  radial-gradient(1000px 700px at -10% 100%, #1e1240 0%, transparent 60%),
                  linear-gradient(180deg, var(--bg) 0%, var(--bg-2) 100%);
      color:var(--fg); overflow-x:hidden;}
    .grid{position:fixed; inset:0; pointer-events:none; opacity:.35;
      background-image:linear-gradient(var(--grid) 1px, transparent 1px),
                       linear-gradient(90deg, var(--grid) 1px, transparent 1px);
      background-size:46px 46px, 46px 46px; mask-image: radial-gradient(ellipse at 50% 30%, rgba(255,255,255,.9) 0%, rgba(255,255,255,.2) 60%, transparent 100%);
      animation:drift 30s linear infinite; z-index:0;}
    @keyframes drift{from{background-position:0 0,0 0} to{background-position:200px 200px,200px 200px}}
    #fx{position:fixed; inset:0; width:100vw; height:100vh; z-index:0; pointer-events:none;}
    .mouse-glow{position:fixed; inset:0; pointer-events:none; z-index:0;
      background: radial-gradient(240px 240px at var(--mx,50%) var(--my,50%), rgba(38,144,255,.25), transparent 70%),
                  radial-gradient(480px 480px at calc(var(--mx,50%) + 8%) calc(var(--my,50%) + 12%), rgba(142,123,255,.18), transparent 70%);}
    header{position:sticky; top:0; z-index:3; display:flex; align-items:center; justify-content:space-between; gap:16px;
      padding:14px 22px; background:linear-gradient(180deg, rgba(10,15,23,.8), rgba(10,15,23,.2)); border-bottom:1px solid var(--border); backdrop-filter: blur(6px);}
    .brand{display:inline-flex; align-items:center; gap:10px; font-weight:800; text-decoration:none; color:var(--fg);}
    .brand svg{width:18px; height:18px}
    .btn{appearance:none; border:1px solid var(--border);
      background:linear-gradient(180deg, rgba(110,168,255,.18), rgba(110,168,255,.06)); color:#eaf2ff; padding:10px 14px; border-radius:10px;
      font-weight:600; font-size:14px; cursor:pointer; text-decoration:none; display:inline-flex; gap:8px;}
    .btn.secondary{ background:linear-gradient(180deg, rgba(142,123,255,.18), rgba(142,123,255,.06)); }
    .btn.mini{ padding:6px 10px; font-size:12px; border-radius:8px; }
    .icon-btn{background:transparent; border:1px solid var(--border); width:36px; height:36px; border-radius:10px; display:inline-grid; place-items:center; cursor:pointer;}
    .icon-btn:hover{border-color:rgba(255,255,255,.16)}
    .wrap{position:relative; z-index:1; padding:26px; max-width:1100px; margin:0 auto;}
    .muted{color:var(--muted)}
    .topline{display:flex; align-items:center; gap:8px; justify-content:center; font-weight:700;}
    .pill{border:1px solid var(--border); border-radius:999px; padding:8px 12px; background:rgba(255,255,255,.05);}
    .pill.primary{border-color:rgba(110,168,255,.40);
      background:linear-gradient(180deg, rgba(110,168,255,.16), rgba(142,123,255,.10));
      box-shadow:0 0 0 1px rgba(110,168,255,.2) inset;}
    .grid-cards{display:grid; grid-template-columns:repeat(auto-fit,minmax(230px,1fr)); gap:18px; margin-top:24px}
    .card{border:1px solid var(--border); background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border-radius:16px; padding:20px; min-height:120px; box-shadow:0 8px 30px rgba(0,0,0,.35);}
    .card h3{margin:0 0 8px; font-size:18px}
    .big{display:grid; grid-template-columns: repeat(4,minmax(160px,1fr)); gap:16px}
    .net{position:relative; border:1px solid var(--border); border-radius:16px; padding:18px; min-height:98px;
      background: radial-gradient(800px 400px at 120% -40%, rgba(110,168,255,.12), transparent 60%),
                  radial-gradient(800px 400px at -10% 120%, rgba(142,123,255,.12), transparent 60%),
                  linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      transition: transform .15s ease, box-shadow .15s ease, border-color .15s ease; cursor:default; display:flex; flex-direction:column; justify-content:space-between; gap:8px;}
    .net:hover{ transform: translateY(-2px); box-shadow:0 8px 30px rgba(0,0,0,.35); border-color:rgba(255,255,255,.16); }
    .net[data-state="off"]{ opacity:.55; filter:saturate(.7); }
    .net[data-state="on"]{ box-shadow:0 0 0 1px rgba(110,168,255,.25), 0 0 22px rgba(110,168,255,.25) inset; }
    .net .row{display:flex; align-items:center; justify-content:space-between;}
    .net .name{font-weight:800; letter-spacing:.6px}
    .badge{font-size:12px; border-radius:999px; padding:6px 10px; border:1px solid var(--border);}
    .badge.on{ color:var(--ok); border-color:rgba(110,247,166,.35); background:rgba(110,247,166,.06);}
    .badge.off{ color:var(--off); background:rgba(255,255,255,.03);}
    .status-dot{width:8px; height:8px; border-radius:50%; margin-right:6px; display:inline-block}
    .status-dot.on{ background:var(--ok); box-shadow:0 0 8px var(--ok);}
    .status-dot.off{ background:var(--off);}
    /* Modal */
    .modal-bg{position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:5;
      background:radial-gradient(600px 400px at 50% 20%, rgba(20,35,70,.6), transparent 60%), rgba(0,0,0,.35); backdrop-filter: blur(4px);}
    .modal{background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02)); border:1px solid var(--border); border-radius:16px; padding:20px; width:min(520px, 92vw);}
    .modal .row{display:flex; gap:10px; align-items:center}
    .modal input{width:100%; padding:10px 12px; border-radius:10px; background:rgba(255,255,255,.04); border:1px solid var(--border); color:var(--fg)}
    /* Side ChatGPT (desktop only) */
    .sidegpt{position:fixed; top:64px; right:12px; width:clamp(420px, 35vw, 560px); height:calc(100vh - 76px);
      border:1px solid var(--border); border-radius:16px; z-index:2; overflow:hidden;
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02)); box-shadow:0 10px 30px rgba(0,0,0,.45); display:none;}
    .sidegpt header{position:sticky; top:0; padding:10px 12px; display:flex; align-items:center; justify-content:space-between;
      background:linear-gradient(180deg, rgba(10,15,23,.86), rgba(10,15,23,.6)); border-bottom:1px solid var(--border);}
    .sidegpt .title{font-weight:800}
    .sidegpt .frame{width:100%; height:100%; border:0; background:#0b0f17}
    .sidegpt .fallback{padding:14px; font-size:14px}
    body.has-side .wrap{ max-width: calc(1100px + 36vw); margin-right: calc(36vw + 32px); }
    @media (min-width: 1200px){ .sidegpt{ display:block; } }
    /* Switch */
    .switch{position:relative; width:54px; height:30px}
    .switch input{opacity:0; width:0; height:0}
    .slider{position:absolute; inset:0; background:rgba(255,255,255,.06); border:1px solid var(--border); border-radius:999px; cursor:pointer; transition:.2s}
    .slider:before{content:""; position:absolute; height:22px; width:22px; left:4px; top:3px; background:#aab6d3; border-radius:50%; transition:.2s}
    .switch input:checked + .slider{background:rgba(110,168,255,.22); border-color:rgba(110,168,255,.45)}
    .switch input:checked + .slider:before{transform:translateX(24px); background:#6ea8ff}
  </style>
  <script type="module">
    addEventListener('mousemove', (e)=>{ document.documentElement.style.setProperty('--mx', e.clientX+'px'); document.documentElement.style.setProperty('--my', e.clientY+'px'); });
    function toggleSideByPref(){ const on = localStorage.getItem('sp_sidegpt_on')!=='0'; if(innerWidth>=1200 && on) document.body.classList.add('has-side'); else document.body.classList.remove('has-side'); }
    addEventListener('resize', toggleSideByPref); addEventListener('DOMContentLoaded', toggleSideByPref);
  </script>

</head>
<body>
<canvas id="fx"></canvas><div class="mouse-glow"></div><div class="grid"></div>
<header>
  
    <a class="brand" href="dashboard.html" title="Voltar ao Dashboard">
      <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><defs><linearGradient id="g" x1="0" y1="0" x2="1" y2="1"><stop offset="0" stop-color="#6ea8ff"/><stop offset="1" stop-color="#8e7bff"/></linearGradient></defs><path d="M36 6L12 36h13l-5 22 32-38H36z" fill="url(#g)"/></svg>
      SocialPrimeBR
    </a>
    
  <div class="row">
    <div class="pill primary" id="wsCurrent">Carregando perfil…</div>
    <a class="btn" href="workspaces.html">Trocar/Adicionar perfil</a>
    <a class="btn" href="settings.html">Configurações ⚙️</a>
    <button class="btn" id="logout">Sair</button>
  </div>
</header>
<div id="sideMount"></div>
<main class="wrap">
  <div class="topline"><span class="pill">Redes Sociais</span></div>
  <p class="muted" id="netInfo">Verifique e conecte as redes para este perfil.</p>
  <div class="big" id="netGrid" style="margin-top:16px"></div>
</main>
<script type="module">
  import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';
  const supabase = createClient("https://mmfqumjckeumidrbysnf.supabase.co", "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1tZnF1bWpja2V1bWlkcmJ5c25mIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYyODg2NzAsImV4cCI6MjA3MTg2NDY3MH0.jlbBLPsz4CqsHqTKTUD5o1xtE8kvAok7x4s3VGaYAAA");
  const cap = (s)=>{ if(!s) return ''; s = s.toString(); return s[0].toUpperCase() + s.slice(1).toLowerCase(); };
  const NETWORKS=[
    {key:'instagram', label:'INSTAGRAM'},
    {key:'facebook', label:'FACEBOOK'},
    {key:'threads', label:'THREADS'},
    {key:'tiktok', label:'TIKTOK'},
    {key:'pinterest', label:'PINTEREST'},
    {key:'youtube', label:'YOUTUBE'},
    {key:'x', label:'X'},
    {key:'google', label:'GOOGLE'}
  ];
  document.getElementById('logout').addEventListener('click', async ()=>{ await supabase.auth.signOut(); location.href='index.html'; });
  function tile(network, state) {
    const el=document.createElement('div'); el.className='net'; el.dataset.state=state?'on':'off';
    const row=document.createElement('div'); row.className='row';
    const name=document.createElement('div'); name.className='name'; name.textContent=network.label;
    const badge=document.createElement('div'); badge.className='badge '+(state?'on':'off'); badge.innerHTML='<span class="status-dot '+(state?'on':'off')+'"></span>'+(state?'Conectado':'Não conectado');
    row.appendChild(name); row.appendChild(badge);
    const actions=document.createElement('div'); actions.className='row';
    const btn=document.createElement('button'); btn.className='btn mini'; btn.textContent= state ? 'Gerenciar' : 'Conectar';
    btn.addEventListener('click', ()=>{ alert('Integrações em breve. Aqui vamos abrir o fluxo de autenticação oficial de '+network.label+'.'); });
    actions.appendChild(btn);
    el.appendChild(row); el.appendChild(actions);
    return el;
  }
  function mountSide(){
    const on = localStorage.getItem('sp_sidegpt_on')!=='0';
    const el = document.getElementById('sideMount');
    el.innerHTML = '';
    if(innerWidth>=1200 && on){
      el.innerHTML = `
    <aside class="sidegpt" id="sidegpt">
      <header>
        <span class="title">ChatGPT</span>
        <a class="btn mini" target="_blank" rel="noopener" href="https://chat.openai.com">Abrir em nova aba</a>
      </header>
      <iframe class="frame" src="https://chat.openai.com" referrerpolicy="no-referrer" sandbox="allow-same-origin allow-scripts allow-forms allow-popups"></iframe>
      <div class="fallback" id="gptFallback" style="display:none">
        Não foi possível carregar o ChatGPT dentro da página (site não permite incorporar). Use o botão acima para abrir em nova aba. Você pode desativar este painel nas <a href='settings.html'>Configurações</a>.
      </div>
      <script>
        const fr = document.currentScript.previousElementSibling;
        let loaded = false;
        try{ fr.addEventListener('load', () => { loaded = true; }); }catch(e){{}}
        setTimeout(() => { if(!loaded) { document.getElementById('gptFallback').style.display='block'; } }, 2500);
        const on = localStorage.getItem('sp_sidegpt_on')!=='0';
        if(!on) document.getElementById('sidegpt').style.display='none';
      </script>
    </aside>
    `;
      document.body.classList.add('has-side');
    }else{
      document.body.classList.remove('has-side');
    }
  }
  addEventListener('resize', mountSide);
  async function boot(){
    const { data: { session } } = await supabase.auth.getSession();
    if(!session){ location.href='login.html'; return; }
    let current=null;
    try{
      const { data: list, error } = await supabase.from('workspaces').select('id,name').order('created_at');
      if(error) throw error;
      if(!list || list.length===0){ location.href='workspaces.html?first=1'; return; }
      const wsId = localStorage.getItem('sp_active_ws_id');
      current = list.find(w=>w.id===wsId) || list[0];
      localStorage.setItem('sp_active_ws_id', current.id);
      localStorage.setItem('sp_active_ws_name', current.name);
      document.getElementById('wsCurrent').innerHTML = '<strong>'+ cap(current.name) +'</strong>';
    }catch(err){
      location.href='workspaces.html?first=1'; return;
    }
    mountSide();
    const grid=document.getElementById('netGrid'); grid.innerHTML='';
    let states={};
    try{ const { data, error } = await supabase.from('connections').select('network,connected').eq('workspace_id', current.id);
      if(!error && data){ data.forEach(r=> states[r.network]=!!r.connected); }
    }catch(e){}
    NETWORKS.forEach(n=> grid.appendChild(tile(n, !!states[n.key])));
  }
  boot();
</script>

  <script>
    const c = document.getElementById('fx'); if(c){ const ctx = c.getContext('2d', {alpha:true});
      let dpr=1,w=0,h=0,parts=[]; const cfg={count:90,maxSpeed:.32,radius:2,linkDist:120};
      function resize(){ dpr=Math.max(1, Math.min(devicePixelRatio||1,2)); w=c.width=Math.floor(innerWidth*dpr); h=c.height=Math.floor(innerHeight*dpr); c.style.width='100vw'; c.style.height='100vh'; }
      function rand(a,b){return a+Math.random()*(b-a)}
      function init(){ parts=Array.from({length:cfg.count},()=>({x:rand(0,w),y:rand(0,h),vx:rand(-cfg.maxSpeed,cfg.maxSpeed),vy:rand(-cfg.maxSpeed,cfg.maxSpeed)})); }
      function step(){ ctx.clearRect(0,0,w,h);
        for(let i=0;i<parts.length;i++){ const p=parts[i]; p.x+=p.vx; p.y+=p.vy; if(p.x<0||p.x>w) p.vx*=-1; if(p.y<0||p.y>h) p.vy*=-1;
          for(let j=i+1;j<parts.length;j++){ const q=parts[j], dx=p.x-q.x, dy=p.y-q.y, dist=Math.hypot(dx,dy);
            if(dist<cfg.linkDist*dpr){ const a=1-dist/(cfg.linkDist*dpr); ctx.strokeStyle='rgba(110,168,255,'+(0.25*a)+')'; ctx.lineWidth=1*dpr; ctx.beginPath(); ctx.moveTo(p.x,p.y); ctx.lineTo(q.x,q.y); ctx.stroke(); }
          }
          ctx.fillStyle='rgba(142,123,255,.9)'; ctx.beginPath(); ctx.arc(p.x,p.y,cfg.radius*dpr,0,Math.PI*2); ctx.fill();
        }
        requestAnimationFrame(step);
      }
      addEventListener('resize', ()=>{ resize(); init(); });
      resize(); init(); step();
    }
  </script>

</body>
</html>
